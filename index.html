<!DOCTYPE html>
<html lang="ta">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>роЯро┐роЬро┐роЯрпНроЯро▓рпН родрпКро▓рпНроХро╛рокрпНрокро┐ропроорпН - роорпБро┤рпБроорпИропро╛рой рокродро┐рокрпНрокрпБ</title>
    <style>
        :root { --primary: #311b92; --accent: #673ab7; --bg: #ede7f6; --text: #212121; --white: #ffffff; --success: #2e7d32; --error: #c62828; }
        body { font-family: 'Latha', 'Arial', sans-serif; background-color: var(--bg); color: var(--text); padding: 20px; line-height: 1.6; margin: 0; }
        
        .main-container { max-width: 1200px; margin: 0 auto; background: var(--white); border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); overflow: hidden; min-height: 90vh; display: flex; flex-direction: column; }
        
        /* Header */
        header { background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; padding: 25px; text-align: center; }
        header h1 { margin: 0; font-size: 2rem; }
        header p { margin: 10px 0 0; opacity: 0.9; font-size: 1rem; }

        /* Tabs */
        .tabs { display: flex; background: #d1c4e9; }
        .tab-btn { flex: 1; padding: 15px; border: none; background: transparent; cursor: pointer; font-size: 1.1rem; font-weight: bold; color: var(--primary); transition: 0.3s; border-bottom: 4px solid transparent; }
        .tab-btn:hover { background: rgba(255,255,255,0.3); }
        .tab-btn.active { background: var(--white); border-bottom-color: var(--primary); color: var(--primary); }

        /* Content Area */
        .content { padding: 30px; flex: 1; display: none; }
        .content.active { display: block; }

        /* Inputs */
        .input-group { margin-bottom: 25px; }
        textarea { width: 100%; height: 120px; padding: 15px; border: 2px solid #b39ddb; border-radius: 8px; font-size: 1.2rem; box-sizing: border-box; resize: vertical; }
        textarea:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(103, 58, 183, 0.2); }
        
        button.analyze-btn { background-color: var(--accent); color: white; padding: 12px 30px; border: none; border-radius: 8px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 15px; width: 100%; transition: transform 0.2s; }
        button.analyze-btn:hover { background-color: var(--primary); transform: translateY(-2px); }

        /* Results Grid */
        .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-top: 20px; }
        
        /* Result Cards */
        .card { border: 1px solid #e0e0e0; border-radius: 10px; padding: 20px; background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .card-header { font-weight: bold; color: var(--primary); border-bottom: 2px solid #f3e5f5; padding-bottom: 10px; margin-bottom: 15px; display: block; font-size: 1.1em; }
        
        /* Sandhi Items */
        .sandhi-item { background: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid var(--accent); }
        .equation { font-size: 1.2em; font-weight: bold; color: var(--primary); }
        .arrow { color: #ff9800; padding: 0 8px; }
        .final { color: var(--success); }
        .rule { font-size: 0.9em; color: #555; margin-top: 5px; display: block; }
        .tag { background: var(--primary); color: white; font-size: 0.75em; padding: 2px 8px; border-radius: 12px; margin-top: 8px; display: inline-block; }

        /* Basic Error Items */
        .error-item { background: #ffebee; color: var(--error); padding: 10px; border-radius: 6px; margin-bottom: 5px; border-left: 4px solid var(--error); }
        .word-badge { background: #fff; padding: 2px 6px; border-radius: 4px; font-weight: bold; color: #333; border: 1px solid #ffcdd2; }

        /* Pirappiyal Cards */
        .pirappu-grid { display: flex; flex-wrap: wrap; gap: 15px; }
        .letter-card { width: 100%; max-width: 200px; background: white; border: 1px solid #ddd; border-radius: 12px; padding: 20px; text-align: center; transition: 0.3s; cursor: default; }
        .letter-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); border-color: var(--accent); }
        .big-char { font-size: 3rem; color: var(--primary); display: block; margin-bottom: 10px; font-weight: bold; }
        .icon-row { font-size: 1.5rem; margin: 10px 0; }
        .desc-text { font-size: 0.9rem; color: #444; line-height: 1.4; }
        .sutra-ref { font-size: 0.8rem; color: #888; margin-top: 10px; display: block; font-style: italic; }

    </style>
</head>
<body>

<div class="main-container">
    <header>
        <h1>роЯро┐роЬро┐роЯрпНроЯро▓рпН родрпКро▓рпНроХро╛рокрпНрокро┐ропроорпН</h1>
        <p>роОро┤рпБродрпНродродро┐роХро╛ро░роорпН роорпБро┤рпБроорпИ: роОро┤рпБродрпНродрпБ | рокро┐ро▒рокрпНрокрпБ | рокрпБрогро░рпНроЪрпНроЪро┐ | рооропроЩрпНроХро┐ропро▓рпН</p>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('grammarTab')">роЗро▓роХрпНроХрогроорпН & рокрпБрогро░рпНроЪрпНроЪро┐</button>
        <button class="tab-btn" onclick="openTab('phoneticsTab')">рокро┐ро▒рокрпНрокро┐ропро▓рпН (роТро▓ро┐рокрпНрокрпБ)</button>
    </div>

    <div id="grammarTab" class="content active">
        <div class="input-group">
            <label style="font-weight:bold; color:var(--primary); display:block; margin-bottom:10px;">роЖропрпНро╡рпБ роЪрпЖропрпНроп ро╡рпЗрогрпНроЯро┐роп роЪрпКро▒рпНроХро│рпИ роЗроЯрпБроХ:</label>
            <textarea id="grammarInput" placeholder="роО.роХро╛: роорогрпН роХрпБроЯроорпН, рооро░роорпН роХро┐ро│рпИ, роТройрпНро▒рпБ рокродрпНродрпБ, ро╡роЯроХрпНроХрпБ роХро┐ро┤роХрпНроХрпБ, роХро▓рпН родрпАродрпБ, рооро╛роорпНрокро┤роорпН... (роЪрпКро▒рпНроХро│рпБроХрпНроХрпБ роЗроЯрпИропро┐ро▓рпН роЗроЯрпИро╡рпЖро│ро┐ родрпЗро╡рпИ)"></textarea>
            <button class="analyze-btn" onclick="runGrammarAnalysis()">ро╡ро┐родро┐роорпБро▒рпИ роЖропрпНро╡рпБ роЪрпЖропрпНроХ</button>
        </div>
        <div id="grammarResults" class="results-grid"></div>
    </div>

    <div id="phoneticsTab" class="content">
        <div class="input-group">
            <label style="font-weight:bold; color:var(--primary); display:block; margin-bottom:10px;">роОро┤рпБродрпНродрпБроХрпНроХро│ро┐ройрпН рокро┐ро▒рокрпНрокрпИ роЕро▒ро┐роп роУро░рпН роОро┤рпБродрпНродрпБ роЕро▓рпНро▓родрпБ роЪрпКро▓рпНро▓рпИ роЗроЯрпБроХ:</label>
            <textarea id="phoneticsInput" placeholder="роО.роХро╛: роХрпН, роорпН, родрооро┐ро┤рпН, роЕроорпНрооро╛..."></textarea>
            <button class="analyze-btn" onclick="runPhoneticsAnalysis()">рокро┐ро▒рокрпНрокро┐роЯродрпНродрпИроХрпН роХрогрпНроЯро▒ро┐</button>
        </div>
        <div id="phoneticsResults" class="pirappu-grid"></div>
    </div>
</div>

<script>
    // --- 1. родро░ро╡рпБроХро│рпН (CONSTANTS) ---
    const UYIR = ["роЕ", "роЖ", "роЗ", "роИ", "роЙ", "роК", "роП", "роР", "роТ", "роУ", "роФ"];
    const VALLINAM = ["роХрпН", "роЪрпН", "роЯрпН", "родрпН", "рокрпН", "ро▒рпН"];
    const MELLINAM = ["роЩрпН", "роЮрпН", "рогрпН", "роирпН", "роорпН", "ройрпН"];
    const IDAIYINAM = ["ропрпН", "ро░рпН", "ро▓рпН", "ро╡рпН", "ро┤рпН", "ро│рпН"];
    const KUTRIYAL = ["роХрпБ", "роЪрпБ", "роЯрпБ", "родрпБ", "рокрпБ", "ро▒рпБ"];
    
    // роЪро┐ро▒рокрпНрокрпБрокрпН рокроЯрпНроЯро┐ропро▓рпНроХро│рпН
    const THISAI = ["ро╡роЯроХрпНроХрпБ", "роХро┐ро┤роХрпНроХрпБ", "родрпЖро▒рпНроХрпБ", "роорпЗро▒рпНроХрпБ", "роХрпБроЯроХрпНроХрпБ", "роХрпБрогроХрпНроХрпБ"];
    const MARA_PEYAR = ["ро╡ро┐ро│", "рокро▓ро╛", "рооро╛", "рокрпБро│ро┐", "ро╡рпЗроорпНрок", "рокройрпИ", "роЕро░рпИ", "роЖро╡ро┐ро░рпИ", "родрпЗроХрпНроХрпБ", "рокро╛роХрпНроХрпБ"];
    const URUBU_LIST = ["роР", "роЖро▓рпН", "роХрпБ", "роЗройрпН", "роЕродрпБ", "роХрогрпН"];

    // роорпКро┤ро┐роорпБродро▓рпН ро╡ро┐родро┐роХро│рпН (Start Check)
    const START_MAPPING = {
        "роХ": ["роХ", "роХро╛", "роХро┐", "роХрпА", "роХрпБ", "роХрпВ", "роХрпЖ", "роХрпЗ", "роХрпИ", "роХрпК", "роХрпЛ", "роХрпМ"],
        "роЪ": ["роЪ", "роЪро╛", "роЪро┐", "роЪрпА", "роЪрпБ", "роЪрпВ", "роЪрпЖ", "роЪрпЗ", "роЪрпК", "роЪрпЛ"],
        "род": ["род", "родро╛", "родро┐", "родрпА", "родрпБ", "родрпВ", "родрпЖ", "родрпЗ", "родрпИ", "родрпК", "родрпЛ", "родрпМ"],
        "рои": ["рои", "роиро╛", "роиро┐", "роирпА", "роирпБ", "роирпВ", "роирпЖ", "роирпЗ", "роирпИ", "роирпК", "роирпЛ", "роирпМ"],
        "рок": ["рок", "рокро╛", "рокро┐", "рокрпА", "рокрпБ", "рокрпВ", "рокрпЖ", "рокрпЗ", "рокрпИ", "рокрпК", "рокрпЛ", "рокрпМ"],
        "роо": ["роо", "рооро╛", "рооро┐", "роорпА", "роорпБ", "роорпВ", "роорпЖ", "роорпЗ", "роорпИ", "роорпК", "роорпЛ", "роорпМ"],
        "ро╡": ["ро╡", "ро╡ро╛", "ро╡ро┐", "ро╡рпА", "ро╡рпЖ", "ро╡рпЗ", "ро╡рпИ", "ро╡рпМ"],
        "роЮ": ["роЮро╛", "роЮрпЖ", "роЮрпК"], "роп": ["ропро╛"]
    };

    // роорпЖропрпНроорпНрооропроХрпНроХ ро╡ро┐родро┐роХро│рпН (Cluster Check)
    const MEYMAYAKKAM_RULES = {
        "роЯрпН": ["роХрпН", "роЪрпН", "рокрпН", "роЯрпН"], "ро▒рпН": ["роХрпН", "роЪрпН", "рокрпН", "ро▒рпН"],
        "ро▓рпН": ["роХрпН", "роЪрпН", "рокрпН", "ропрпН", "ро╡рпН"], "ро│рпН": ["роХрпН", "роЪрпН", "рокрпН", "ропрпН", "ро╡рпН"],
        "роЩрпН": ["роХрпН"], "роЮрпН": ["роЪрпН", "ропрпН", "роЮрпН"], "рогрпН": ["роЯрпН", "рогрпН"],
        "роирпН": ["родрпН", "ропрпН", "роирпН"], "роорпН": ["рокрпН", "ропрпН", "ро╡рпН", "роорпН"], "ройрпН": ["ро▒рпН", "ройрпН"],
        "ропрпН": ["роХрпН", "роЪрпН", "родрпН", "рокрпН", "роЩрпН", "роЮрпН", "роирпН", "роорпН", "ропрпН", "ро╡рпН"],
        "ро░рпН": ["роХрпН", "роЪрпН", "родрпН", "рокрпН", "роЩрпН", "роЮрпН", "роирпН", "роорпН", "ропрпН", "ро╡рпН", "ро░рпН"],
        "ро┤рпН": ["роХрпН", "роЪрпН", "родрпН", "рокрпН", "роЩрпН", "роЮрпН", "роирпН", "роорпН", "ропрпН", "ро╡рпН", "ро┤рпН"],
        "ро╡рпН": ["ропрпН", "ро╡рпН"]
    };

    // рокро┐ро▒рокрпНрокро┐ропро▓рпН родро░ро╡рпБроХро│рпН (Phonetics)
    const PIRAPPIYAL_DATA = {
        "роЕ": { text: "ро╡ро╛ропрпН роЕроЩрпНроХро╛роирпНродрпБ (родро┐ро▒роирпНродрпБ) роЗропро▓рпБроорпН.", icon: "ЁЯСД", sutra: "роирпВро▒рпНрокро╛ 3" },
        "роЖ": { text: "ро╡ро╛ропрпН роЕроЩрпНроХро╛роирпНродрпБ (родро┐ро▒роирпНродрпБ) роЗропро▓рпБроорпН.", icon: "ЁЯСД", sutra: "роирпВро▒рпНрокро╛ 3" },
        "роЗ": { text: "ро╡ро╛ропрпН роЕроЩрпНроХро╛родрпНродро▓рпН + роиро╛ро╡ро┐ро│ро┐роорпНрокрпБ рокро▓рпНро▓рпИродрпН родрпКроЯрпБродро▓рпН.", icon: "ЁЯСД + ЁЯСЕЁЯж╖", sutra: "роирпВро▒рпНрокро╛ 4" },
        "роИ": { text: "ро╡ро╛ропрпН роЕроЩрпНроХро╛родрпНродро▓рпН + роиро╛ро╡ро┐ро│ро┐роорпНрокрпБ рокро▓рпНро▓рпИродрпН родрпКроЯрпБродро▓рпН.", icon: "ЁЯСД + ЁЯСЕЁЯж╖", sutra: "роирпВро▒рпНрокро╛ 4" },
        "роЙ": { text: "роЗродро┤рпН роХрпБро╡ро┐роирпНродрпБ роЗропро▓рпБроорпН.", icon: "ЁЯСДтнХ", sutra: "роирпВро▒рпНрокро╛ 5" },
        "роК": { text: "роЗродро┤рпН роХрпБро╡ро┐роирпНродрпБ роЗропро▓рпБроорпН.", icon: "ЁЯСДтнХ", sutra: "роирпВро▒рпНрокро╛ 5" },
        "роХрпН": { text: "роорпБродро▓рпН роиро╛, роорпБродро▓рпН роЕрогрпНрогродрпНродрпИ роТро▒рпНро▒рокрпН рокро┐ро▒роХрпНроХрпБроорпН.", icon: "ЁЯСЕ(рокро┐ройрпН) + ЁЯза(роорпЗро▓рпНро╡ро╛ропрпН)", sutra: "роирпВро▒рпНрокро╛ 7" },
        "роЩрпН": { text: "роорпБродро▓рпН роиро╛ роЕрогрпНрогроорпН роТро▒рпНро▒ (роорпВроХрпНроХрпБ ро╡ро│ро┐ропрпБроЯройрпН).", icon: "ЁЯСЕ + ЁЯза + ЁЯСГ", sutra: "роирпВро▒рпНрокро╛ 7, 18" },
        "роЪрпН": { text: "роЗроЯрпИ роиро╛, роЗроЯрпИ роЕрогрпНрогродрпНродрпИ роТро▒рпНро▒рокрпН рокро┐ро▒роХрпНроХрпБроорпН.", icon: "ЁЯСЕ(роироЯрпБ) + ЁЯза(роироЯрпБ)", sutra: "роирпВро▒рпНрокро╛ 8" },
        "роЮрпН": { text: "роЗроЯрпИ роиро╛ роЕрогрпНрогроорпН роТро▒рпНро▒ (роорпВроХрпНроХрпБ ро╡ро│ро┐ропрпБроЯройрпН).", icon: "ЁЯСЕ + ЁЯза + ЁЯСГ", sutra: "роирпВро▒рпНрокро╛ 8, 18" },
        "роЯрпН": { text: "роирпБройро┐ роиро╛, роирпБройро┐ роЕрогрпНрогродрпНродрпИ роТро▒рпНро▒рокрпН рокро┐ро▒роХрпНроХрпБроорпН.", icon: "ЁЯСЕ(роирпБройро┐) + ЁЯза(роирпБройро┐)", sutra: "роирпВро▒рпНрокро╛ 9" },
        "рогрпН": { text: "роирпБройро┐ роиро╛ роЕрогрпНрогроорпН роТро▒рпНро▒ (роорпВроХрпНроХрпБ ро╡ро│ро┐ропрпБроЯройрпН).", icon: "ЁЯСЕ + ЁЯза + ЁЯСГ", sutra: "роирпВро▒рпНрокро╛ 9, 18" },
        "родрпН": { text: "роиро╛ роирпБройро┐ рокро░роирпНродрпБ, рокро▓рпНро▓ро┐ройрпН роЕроЯро┐ропрпИ роТро▒рпНро▒рокрпН рокро┐ро▒роХрпНроХрпБроорпН.", icon: "ЁЯСЕ(рокро░роирпНродрпБ) + ЁЯж╖(роЕроЯро┐)", sutra: "роирпВро▒рпНрокро╛ 11" },
        "роирпН": { text: "роиро╛ роирпБройро┐ рокро░роирпНродрпБ рокро▓рпНро▓рпИ роТро▒рпНро▒ (роорпВроХрпНроХрпБ ро╡ро│ро┐ропрпБроЯройрпН).", icon: "ЁЯСЕ + ЁЯж╖ + ЁЯСГ", sutra: "роирпВро▒рпНрокро╛ 11, 18" },
        "ро▒рпН": { text: "роирпБройро┐ роиро╛, роЕрогрпНрогродрпНродро┐ройрпН роирпБройро┐ропрпИ (роЕрогро░ро┐) роТро▒рпНро▒рокрпН рокро┐ро▒роХрпНроХрпБроорпН.", icon: "ЁЯСЕ(роирпБройро┐) + ЁЯза(роЕрогро░ро┐)", sutra: "роирпВро▒рпНрокро╛ 12" },
        "ройрпН": { text: "роирпБройро┐ роиро╛ роЕрогро░ро┐ роТро▒рпНро▒ (роорпВроХрпНроХрпБ ро╡ро│ро┐ропрпБроЯройрпН).", icon: "ЁЯСЕ + ЁЯза + ЁЯСГ", sutra: "роирпВро▒рпНрокро╛ 12, 18" },
        "рокрпН": { text: "роЗродро┤рпН роЗро░рогрпНроЯрпБроорпН роЗропрпИропрокрпН (роТроЯрпНроЯ) рокро┐ро▒роХрпНроХрпБроорпН.", icon: "ЁЯСДтЮХЁЯСД", sutra: "роирпВро▒рпНрокро╛ 15" },
        "роорпН": { text: "роЗродро┤рпН роЗро░рогрпНроЯрпБроорпН роЗропрпИроп (роорпВроХрпНроХрпБ ро╡ро│ро┐ропрпБроЯройрпН).", icon: "ЁЯСДтЮХЁЯСД + ЁЯСГ", sutra: "роирпВро▒рпНрокро╛ 15, 18" },
        "ропрпН": { text: "роЕрогрпНрогродрпНродрпИ рооро┐роЯро▒рпНро▒рпБ ро╡ро│ро┐ ро╡роирпНродрпБ роЕроЯрпИропрокрпН рокро┐ро▒роХрпНроХрпБроорпН.", icon: "ЁЯТи(рооро┐роЯро▒рпБ) + ЁЯза", sutra: "роирпВро▒рпНрокро╛ 17" },
        "ро░рпН": { text: "роирпБройро┐ роиро╛, роЕрогрпНрогродрпНродрпИ ро╡ро░рпБроЯрокрпН (родроЯро╡) рокро┐ро▒роХрпНроХрпБроорпН.", icon: "ЁЯСЕ уА░я╕П ЁЯза", sutra: "роирпВро▒рпНрокро╛ 13" },
        "ро▓рпН": { text: "роиро╛ ро╡ро┐ро│ро┐роорпНрокрпБ ро╡рпАроЩрпНроХро┐, рокро▓рпН роЕроЯро┐ропрпИ роТро▒рпНро▒рокрпН рокро┐ро▒роХрпНроХрпБроорпН.", icon: "ЁЯСЕ(ро╡ро┐ро│ро┐роорпНрокрпБ) + ЁЯж╖(роЕроЯро┐)", sutra: "роирпВро▒рпНрокро╛ 14" },
        "ро╡рпН": { text: "рокро▓рпН, роЗродро┤рпИ роЗропрпИропрокрпН (роХроЯро┐роХрпНроХ) рокро┐ро▒роХрпНроХрпБроорпН.", icon: "ЁЯж╖ + ЁЯСД", sutra: "роирпВро▒рпНрокро╛ 16" },
        "ро┤рпН": { text: "роирпБройро┐ роиро╛, роЕрогрпНрогродрпНродрпИ ро╡ро░рпБроЯрокрпН рокро┐ро▒роХрпНроХрпБроорпН (роЪро┐ро▒рокрпНрокрпБ ро┤роХро░роорпН).", icon: "ЁЯСЕ уА░я╕П ЁЯза", sutra: "роирпВро▒рпНрокро╛ 13" },
        "ро│рпН": { text: "роиро╛ ро╡ро┐ро│ро┐роорпНрокрпБ ро╡рпАроЩрпНроХро┐, роЕрогрпНрогродрпНродрпИ ро╡ро░рпБроЯрокрпН рокро┐ро▒роХрпНроХрпБроорпН.", icon: "ЁЯСЕ(ро╡ро┐ро│ро┐роорпНрокрпБ) + ЁЯза", sutra: "роирпВро▒рпНрокро╛ 14" }
    };

    // --- 2. роЙродро╡ро┐роХрпН роХро░рпБро╡ро┐роХро│рпН (UTILITIES) ---
    function openTab(tabId) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function getTamilLetters(word) {
        return word.match(/[\u0B80-\u0BFF][\u0BCD\u0BBE-\u0BCC\u0BD7]?/g) || [];
    }
    
    function getRootMei(char) {
        if (UYIR.includes(char)) return null;
        let code = char.charCodeAt(0);
        if (code >= 2965 && code <= 2999) return String.fromCharCode(code) + "рпН";
        return char;
    }

    function getBaseChar(char) { return char.charAt(0); }

    function getEndingUyir(char) {
        if(UYIR.includes(char)) return char;
        const suffixes = { "ро╛": "роЖ", "ро┐": "роЗ", "рпА": "роИ", "рпБ": "роЙ", "рпВ": "роК", "рпЖ": "роО", "рпЗ": "роП", "рпИ": "роР", "рпК": "роТ", "рпЛ": "роУ", "рпМ": "роФ" };
        for (let s in suffixes) if(char.endsWith(s)) return suffixes[s];
        if(!char.includes("рпН")) return "роЕ";
        return null;
    }

    // --- 3. роЗро▓роХрпНроХрог & рокрпБрогро░рпНроЪрпНроЪро┐ роЖропрпНро╡рпБ (GRAMMAR ANALYSIS) ---
    function runGrammarAnalysis() {
        const text = document.getElementById('grammarInput').value;
        const resultDiv = document.getElementById('grammarResults');
        resultDiv.innerHTML = "";
        
        if(!text.trim()) return;
        const words = text.split(/\s+/).filter(w => w.length > 0);
        
        // роЕ. родройро┐роЪрпНроЪрпКро▓рпН рокро┐ро┤рпИ роЖропрпНро╡рпБ (Basic)
        let basicErrors = [];
        words.forEach(word => {
            let clean = word.replace(/[.,;!?)"(]/g, "");
            let letters = getTamilLetters(clean);
            if(letters.length < 1) return;
            
            // 1. роорпКро┤ро┐роорпБродро▓рпН
            let first = letters[0];
            let isValidStart = false;
            if(UYIR.includes(first)) isValidStart = true;
            else {
                let base = getBaseChar(first);
                if(START_MAPPING[base] && START_MAPPING[base].includes(first)) isValidStart = true;
            }
            if(!isValidStart) basicErrors.push({word: clean, msg: `'${first}' роОро┤рпБродрпНродро┐ро▓рпН родрпКроЯроЩрпНроХроХрпНроХрпВроЯро╛родрпБ.`});

            // 2. роорпКро┤ро┐ропро┐ро▒рпБродро┐ (ро╡ро▓рпНро▓ро┐ройроорпН)
            let last = letters[letters.length-1];
            if(VALLINAM.includes(last)) basicErrors.push({word: clean, msg: `'${last}' роОро┤рпБродрпНродро┐ро▓рпН (ро╡ро▓рпНро▓ро┐ройроорпН) роорпБроЯро┐ропроХрпНроХрпВроЯро╛родрпБ.`});

            // 3. роорпЖропрпНроорпНрооропроХрпНроХроорпН
            for(let i=0; i<letters.length-1; i++){
                let curr = letters[i];
                let next = letters[i+1];
                if(curr.includes('рпН') && MEYMAYAKKAM_RULES[curr]) {
                    let nextRoot = getRootMei(next);
                    if(nextRoot && !MEYMAYAKKAM_RULES[curr].includes(nextRoot)) {
                        basicErrors.push({word: clean, msg: `'${curr}' роЕроЯрпБродрпНродрпБ '${next}' ро╡ро░роХрпНроХрпВроЯро╛родрпБ.`});
                    }
                }
            }
        });

        // роЖ. рокрпБрогро░рпНроЪрпНроЪро┐ роЖропрпНро╡рпБ (Advanced Sandhi)
        let sandhiResults = [];
        for (let i = 0; i < words.length - 1; i++) {
            let w1 = words[i].replace(/[.,;!?)"(]/g, "");
            let w2 = words[i+1].replace(/[.,;!?)"(]/g, "");
            if(w1.length > 0 && w2.length > 0) {
                let res = checkSandhi(w1, w2);
                if(res) sandhiResults.push(res);
            }
        }

        // роХро╛роЯрпНроЪро┐рокрпНрокроЯрпБродрпНродро▓рпН (Rendering)
        if(basicErrors.length > 0) {
            let errHTML = `<div class="card"><span class="card-header" style="color:var(--error)">родройро┐роЪрпНроЪрпКро▓рпН рокро┐ро┤рпИроХро│рпН</span>`;
            basicErrors.forEach(e => errHTML += `<div class="error-item"><span class="word-badge">${e.word}</span> ${e.msg}</div>`);
            errHTML += `</div>`;
            resultDiv.innerHTML += errHTML;
        }

        if(sandhiResults.length > 0) {
            let sandhiHTML = `<div class="card"><span class="card-header">рокрпБрогро░рпНроЪрпНроЪро┐ роорпБроЯро┐ро╡рпБроХро│рпН</span>`;
            sandhiResults.forEach(item => {
                sandhiHTML += `
                    <div class="sandhi-item">
                        <div class="equation">${item.w1} + ${item.w2} <span class="arrow">тЮЭ</span> <span class="final">${item.res}</span></div>
                        <span class="rule">${item.rule}</span>
                        <span class="tag">${item.sutra}</span>
                    </div>`;
            });
            sandhiHTML += `</div>`;
            resultDiv.innerHTML += sandhiHTML;
        } else if(basicErrors.length === 0) {
             resultDiv.innerHTML += `<div class="card"><p>роХрпБро▒ро┐рокрпНрокро┐роЯродрпНродроХрпНроХ рокрпБрогро░рпНроЪрпНроЪро┐ рооро╛ро▒рпНро▒роорпН роЗро▓рпНро▓рпИ роЕро▓рпНро▓родрпБ роЗропро▓рпНрокро╛роХ роЙро│рпНро│родрпБ.</p></div>`;
        }
    }

    // --- рокрпБрогро░рпНроЪрпНроЪро┐ ро▓ро╛роЬро┐роХрпН (SANDHI ENGINE) ---
    function checkSandhi(w1, w2) {
        let l1 = getTamilLetters(w1);
        let l2 = getTamilLetters(w2);
        let last = l1[l1.length-1];
        let endUyir = getEndingUyir(last);
        let first = l2[0];
        let firstRoot = getRootMei(first);
        let isVallinam = VALLINAM.includes(firstRoot);

        // 1. роОрогрпНроХро│рпН (роХрпБро▒рпНро▒ро┐ропро▓рпБроХро░роорпН) - Numbers
        if(w2 === "рокродрпНродрпБ") {
            const numMap = {"роТройрпНро▒рпБ":"роТро░рпБрокродрпБ", "роЗро░рогрпНроЯрпБ":"роЗро░рпБрокродрпБ", "роорпВройрпНро▒рпБ":"роорпБрокрпНрокродрпБ", "роиро╛ройрпНроХрпБ":"роиро╛ро▒рпНрокродрпБ", "роРроирпНродрпБ":"роРроорпНрокродрпБ", "роЖро▒рпБ":"роЕро▒рпБрокродрпБ", "роОроЯрпНроЯрпБ":"роОрогрпНрокродрпБ", "роТройрпНрокродрпБ":"родрпКрогрпНрогрпВро▒рпБ"};
            if(numMap[w1]) return {w1, w2, res: numMap[w1], rule: "роОрогрпН рокрпБрогро░рпНроЪрпНроЪро┐родрпН родро┐ро░ро┐рокрпБ", sutra: "роХрпБро▒рпНро▒ро┐ропро▓рпБроХро░роорпН 33-39"};
        }

        // 2. родро┐роЪрпИроХро│рпН (Directions)
        if(THISAI.includes(w1) && THISAI.includes(w2)) {
            let base = w1.substring(0, 2); // ро╡роЯ, роХрпБрог, роХрпБроЯ
            if(w1==="родрпЖро▒рпНроХрпБ") base="родрпЖройрпН"; if(w1==="роорпЗро▒рпНроХрпБ") base="роорпЗро▓рпН";
            return {w1, w2, res: base+w2, rule: "родро┐роЪрпИрокрпН рокрпЖропро░ро┐ро▓рпН роИро▒рпБ роХрпЖроЯрпБроорпН/родро┐ро░ро┐ропрпБроорпН", sutra: "роХрпБро▒рпНро▒ро┐ропро▓рпБроХро░роорпН 26"};
        }

        // 3. роЙро░рпБрокро┐ропро▓рпН (Case Markers)
        if(URUBU_LIST.includes(w2)) {
            if(w1==="рооро░роорпН" && w2==="роР") return {w1, w2, res:"рооро░родрпНродрпИ", rule:"роороХро░ роИро▒рпБ роЕродрпНродрпБроЪрпН роЪро╛ро░ро┐ропрпИ рокрпЖро▒рпБроорпН", sutra:"роЙро░рпБрокро┐ропро▓рпН 13"};
            if(w1==="роЕродрпБ" && w2==="роР") return {w1, w2, res:"роЕродройрпИ", rule:"роЙроХро░роорпН роХрпЖроЯрпНроЯрпБ роЕройрпН роЪро╛ро░ро┐ропрпИ рокрпЖро▒рпБроорпН", sutra:"роЙро░рпБрокро┐ропро▓рпН 4"};
            if(w1==="ро╡рогрпНроЯрпБ" && w2==="роР") return {w1, w2, res:"ро╡рогрпНроЯро┐ройрпИ", rule:"роХрпБро▒рпНро▒ро┐ропро▓рпБроХро░роорпН роЗройрпН роЪро╛ро░ро┐ропрпИ рокрпЖро▒рпБроорпН", sutra:"роЙро░рпБрокро┐ропро▓рпН 23"};
            if(w1==="рокро▓" && w2==="роР") return {w1, w2, res:"рокро▓ро╡ро▒рпНро▒рпИ", rule:"роЕроХро░ роИро▒рпБ ро╡ро▒рпНро▒рпБроЪрпН роЪро╛ро░ро┐ропрпИ рокрпЖро▒рпБроорпН", sutra:"роЙро░рпБрокро┐ропро▓рпН 2"};
        }

        // 4. рокрпБро│рпНро│ро┐ рооропроЩрпНроХро┐ропро▓рпН (Consonants)
        if(last==="рогрпН" && isVallinam) return {w1, w2, res: w1.slice(0,-1)+"роЯрпН"+w2, rule:"рогроХро░ роИро▒рпБ роЯроХро░рооро╛роХрпБроорпН", sutra:"рокрпБро│рпНро│ро┐ рооропроЩрпНроХро┐ропро▓рпН 7"};
        if(last==="роорпН" && isVallinam) return {w1, w2, res: w1.slice(0,-1)+firstRoot+w2, rule:"роороХро░ роИро▒рпБ роХрпЖроЯрпНроЯрпБ ро╡ро▓рпНро▓ро┐ройроорпН рооро┐роХрпБроорпН", sutra:"рокрпБро│рпНро│ро┐ рооропроЩрпНроХро┐ропро▓рпН 15"};
        if(last==="ро▓рпН" && firstRoot==="родрпН") return {w1, w2, res: w1.slice(0,-1)+"ро▒рпН"+"ро▒"+w2.slice(1), rule:"ро▓+род = ро▒рпНро▒", sutra:"рокрпБро│рпНро│ро┐ рооропроЩрпНроХро┐ропро▓рпН 71"};
        if(last==="ро│рпН" && firstRoot==="родрпН") return {w1, w2, res: w1.slice(0,-1)+"роЯрпН"+"роЯ"+w2.slice(1), rule:"ро│+род = роЯрпНроЯ", sutra:"рокрпБро│рпНро│ро┐ рооропроЩрпНроХро┐ропро▓рпН 101"};
        if(last==="ро▓рпН" && isVallinam) return {w1, w2, res: w1.slice(0,-1)+"ро▒рпН"+w2, rule:"ро▓роХро░ роИро▒рпБ ро╡ро▓рпНро▓рпЖро┤рпБродрпНродро┐ро▓рпН ро▒роХро░рооро╛роХрпБроорпН", sutra:"рокрпБро│рпНро│ро┐ рооропроЩрпНроХро┐ропро▓рпН 71"};

        // 5. роЙропро┐ро░рпН рооропроЩрпНроХро┐ропро▓рпН (Vowels)
        if(endUyir==="роЕ" && ["рокро▓", "роЪро┐ро▓"].includes(w1) && isVallinam) return {w1, w2, res: w1+firstRoot+w2, rule:"роЕроХро░ роИро▒рпБ ро╡ро▓рпНро▓ро┐ройроорпН рооро┐роХрпБроорпН", sutra:"роЙропро┐ро░рпН рооропроЩрпНроХро┐ропро▓рпН 1"};
        if(endUyir==="роР" && ["рокройрпИ", "роЕро░рпИ"].includes(w1) && isVallinam) {
             let map={"роХрпН":"роЩрпН", "роЪрпН":"роЮрпН", "родрпН":"роирпН", "рокрпН":"роорпН"};
             if(map[firstRoot]) return {w1, w2, res: w1.slice(0,-1)+"ройрпН"+map[firstRoot]+w2, rule:"роР роХрпЖроЯрпНроЯрпБ роЕроорпН ро╡ро░рпБроорпН", sutra:"роЙропро┐ро░рпН рооропроЩрпНроХро┐ропро▓рпН 81"};
        }
        
        // 6. роХрпБро▒рпНро▒ро┐ропро▓рпБроХро░роорпН рокрпКродрпБ (General)
        if(KUTRIYAL.includes(last) && l1.length > 1 && isVallinam) {
            if(MARA_PEYAR.includes(w1)) {
                 let map={"роХрпН":"роЩрпН", "роЪрпН":"роЮрпН", "родрпН":"роирпН", "рокрпН":"роорпН"};
                 if(map[firstRoot]) return {w1, w2, res: w1.slice(0,-1)+"роХрпН"+"роЕ"+map[firstRoot]+w2, rule:"рооро░рокрпНрокрпЖропро░рпН роЕроорпН роЪро╛ро░ро┐ропрпИ рокрпЖро▒рпБроорпН", sutra:"роХрпБро▒рпНро▒ро┐ропро▓рпБроХро░роорпН 10"};
            }
            return {w1, w2, res: w1+firstRoot+w2, rule:"роХрпБро▒рпНро▒ро┐ропро▓рпБроХро░роорпН ро╡ро▓рпНро▓ро┐ройроорпН рооро┐роХрпБроорпН", sutra:"роХрпБро▒рпНро▒ро┐ропро▓рпБроХро░роорпН 21"};
        }

        return null;
    }

    // --- 4. рокро┐ро▒рокрпНрокро┐ропро▓рпН роЖропрпНро╡рпБ (PHONETICS) ---
    function runPhoneticsAnalysis() {
        const text = document.getElementById('phoneticsInput').value;
        const resultDiv = document.getElementById('phoneticsResults');
        resultDiv.innerHTML = "";
        
        if(!text.trim()) return;
        const letters = getTamilLetters(text);
        
        letters.forEach(char => {
            let mei = getRootMei(char);
            let displayChar = char;
            let info = null;

            if(mei) {
                // It's a consonant or uyirmei
                let cleanMei = mei; // e.g., роХрпН
                if(PIRAPPIYAL_DATA[cleanMei]) info = PIRAPPIYAL_DATA[cleanMei];
            } else {
                // It's a vowel
                if(PIRAPPIYAL_DATA[char]) info = PIRAPPIYAL_DATA[char];
            }

            if(info) {
                resultDiv.innerHTML += `
                    <div class="letter-card">
                        <span class="big-char">${displayChar}</span>
                        <div class="icon-row">${info.icon}</div>
                        <div class="desc-text">${info.text}</div>
                        <span class="sutra-ref">${info.sutra}</span>
                    </div>`;
            }
        });
    }

</script>

</body>
</html>
